---
title: Agent Smith Repository Cleanup Plan
category: analysis
status: archived
created: 2025-11-23
last_updated: 2025-11-23
tags: [cleanup, repository-structure, build-artifacts, maintenance, historical]
archival_note: Superseded by marketplace distribution strategy
---

# Agent Smith - Repository Cleanup Plan

**Date**: 2025-11-23
**Purpose**: Remove redundant and temporary directories after skill packaging

> **âš ï¸ NOTE**: This document is historical. The packaged skill distribution approach was replaced with marketplace/plugin distribution on 2025-11-23. Many recommendations in this document (build-skill.sh, .skill packaging, etc.) are no longer applicable.

## Analysis Summary

Total directories analyzed: 22
Directories to remove: 4 (venv/, .claude/, skill/scripts/, data/templates/)
Directories to keep: 2 (commands/, templates/ - ACTIVE SOURCE CODE)
Space to reclaim: ~2.0 MB + build artifacts
Build artifacts to gitignore: 6 (including data/templates/)

---

## 1. Redundant Directories (REMOVE)

### 1.1 Old Virtual Environment
**Directory**: `venv/` (32K)
**Status**: âŒ REDUNDANT
**Reason**: Old virtualenv, replaced by uv-managed `.venv`
**Current**: Using `.venv/` with `uv` for dependency management
**Action**: DELETE

---

### 1.2 Unrelated Graphite Plugin Configuration
**Directory**: `.claude/` (contains graphite-skill/)
**Status**: âŒ UNRELATED
**Reason**: Contains Graphite plugin configuration, not related to Agent Smith
**Action**: DELETE (not part of Agent Smith)

Files:
- `.claude/plugins/graphite-skill/settings.json`
- `.claude/plugins/graphite-skill/hooks/session-start.sh`
- `.claude/agents/graphite-ops-template.md`
- `.claude/settings.local.json`

Note: This is completely unrelated to Agent Smith and should be removed.

---

### 1.3 Skill Scripts (Build Artifact)
**Directory**: `skill/scripts/` (copied from `scripts/`)
**Status**: âš ï¸ BUILD ARTIFACT
**Reason**: Should be regenerated by build script, not committed
**Source**: `scripts/` (main source)
**Action**: DELETE from repo, regenerate during build

---

### 1.4 Runtime Template Data
**Directory**: `data/templates/` (4 YAML files)
**Status**: âš ï¸ RUNTIME OUTPUT
**Reason**: Generated by smith:install command, not source code
**Source**: `templates/` (composable template system)
**Action**: DELETE from repo, add to .gitignore

Files currently committed:
- `data/templates/simple.yaml`
- `data/templates/shared-household.yaml`
- `data/templates/separated-families.yaml`
- `data/templates/advanced.yaml`

These are generated by merging composable templates from `templates/primary/`, `templates/living/`, and `templates/additional/` based on user choices during installation.

**Note**: Code in `scripts/setup/template_selector.py` still references old `data/templates/` path and needs updating to use new `templates/` source.

---

## 2. Build Artifacts (CLEAN & GITIGNORE)

### 2.1 Python Cache Directories
**Directories**:
- `.pytest_cache/` - pytest cache
- `.mypy_cache/` - mypy type checker cache
- `.ruff_cache/` - ruff linter cache

**Status**: âš ï¸ BUILD ARTIFACTS
**Action**: DELETE, ensure .gitignored

---

### 2.2 Coverage Reports
**Directory**: `htmlcov/` (140K)
**Status**: âš ï¸ BUILD ARTIFACT
**Reason**: HTML coverage reports from pytest-cov
**Action**: DELETE, ensure .gitignored

---

### 2.3 Python Package Metadata
**Directory**: `agent_smith.egg-info/` (56K)
**Status**: âš ï¸ BUILD ARTIFACT
**Reason**: Generated by pip/setuptools during editable install
**Action**: DELETE, ensure .gitignored

---

## 3. Keep (Already Tracked)

### 3.1 Plugin System
**Directories**: `.claude-plugin/` and `commands/`
**Status**: âœ… KEEP
**Reason**: Active plugin system for Claude Code
**Files**:
- `.claude-plugin/plugin.json` - Plugin definition (references commands/)
- `.claude-plugin/marketplace.json` - Marketplace metadata
- `commands/` - Slash command definitions (smith:install, smith:categorize, etc.)

**Action**: KEEP, both directories work together

---

### 3.2 Composable Template System
**Directory**: `templates/`
**Status**: âœ… KEEP
**Reason**: Source code for composable template system (updated 2025-11-23)
**Structure**:
- `templates/primary/` - Employment type (payg-employee, sole-trader)
- `templates/living/` - Living situation (single, shared-hybrid, separated-parents)
- `templates/additional/` - Investment types (property-investor, share-investor)

**Action**: KEEP, this is the active source code

---

### 3.3 Skill Source
**Directory**: `skill/`
**Status**: âœ… KEEP (with modifications)
**Reason**: Source directory for skill package
**Action**: KEEP, but exclude build artifacts (skill/scripts/)

---

### 3.4 Working Directories
**Directories**:
- `backups/` - Timestamped backups (30-day retention)
- `logs/` - Execution logs (14-day retention)
- `reports/` - Generated reports (90-day retention)
- `data/` - Working data and configuration

**Status**: âœ… KEEP (structure only)
**Action**: KEEP directories, contents already gitignored

---

## 4. Cleanup Actions Summary

### Phase 1: Safe Removals (Redundant Directories)
```bash
# 1. Remove old venv
rm -rf venv/

# 2. Remove unrelated Graphite config
rm -rf .claude/

# 3. Remove skill build artifact (will be regenerated)
rm -rf skill/scripts/

# 4. Remove runtime template data from git tracking
git rm -r data/templates/
```

**Space reclaimed**: ~32K + graphite files + skill/scripts/
**Note**: commands/ and templates/ are KEPT (active source code)

---

### Phase 2: Clean Build Artifacts
```bash
# Clean Python caches
rm -rf .pytest_cache/ .mypy_cache/ .ruff_cache/

# Clean coverage reports
rm -rf htmlcov/

# Clean package metadata
rm -rf agent_smith.egg-info/
```

**Space reclaimed**: ~196K + caches

---

### Phase 3: Update .gitignore
Add the following entries to `.gitignore`:

```gitignore
# Build artifacts (additional entries)
.pytest_cache/
.mypy_cache/
.ruff_cache/
htmlcov/
*.egg-info/

# Skill build artifacts (scripts are copied during build)
skill/scripts/

# Runtime template data (generated by smith:install)
data/templates/

# Virtual environments (old structure)
venv/
```

Note: Most build artifact patterns are already covered, but data/templates/ must be explicitly added since it's currently tracked in git.

---

### Phase 4: Update Build Script
Modify `build-skill.sh` to:

1. Always clean `skill/scripts/` before copying
2. Copy fresh scripts from `scripts/` source
3. Verify critical files exist before packaging

Updated section:
```bash
# Update scripts from source
echo "Updating scripts from source..."
if [ -d skill/scripts ]; then
    echo "  Removing old scripts..."
    rm -rf skill/scripts
fi
echo "  Copying fresh scripts from source..."
cp -r scripts skill/
```

This ensures `skill/scripts/` is always in sync with `scripts/`.

---

## 5. Validation Checklist

After cleanup, verify:

- [ ] `venv/` removed
- [ ] `.claude/` removed
- [ ] `skill/scripts/` removed (regenerated by build)
- [ ] `data/templates/` removed from git (git rm -r data/templates/)
- [ ] All cache directories removed
- [ ] `htmlcov/` removed
- [ ] `agent_smith.egg-info/` removed
- [ ] `.gitignore` updated
- [ ] `build-skill.sh` updated (already correct)
- [ ] `commands/` still present (KEEP - active plugin system)
- [ ] `templates/` still present (KEEP - source code)
- [ ] Build script runs successfully: `./build-skill.sh`
- [ ] Generated skill package verified: `unzip -l agent-smith.skill | grep SKILL.md`
- [ ] Git status clean (no unexpected changes)
- [ ] Tests still pass: `pytest tests/unit -v`

---

## 6. Git Workflow

After cleanup:

```bash
# Check status
git status

# Add updated files
git add .gitignore

# Commit cleanup
git commit -m "chore: Clean up redundant directories and build artifacts

- Remove old venv/ directory (using .venv with uv)
- Remove unrelated .claude/ graphite configuration
- Remove skill/scripts/ build artifact (regenerated by build-skill.sh)
- Remove data/templates/ runtime output from git tracking
- Clean build artifacts (caches, htmlcov, egg-info)
- Update .gitignore for build artifacts and runtime data

Note: commands/ and templates/ are KEPT (active source code)"

# Verify clean state
git status
```

---

## 7. Risk Assessment

### Low Risk
- Removing `venv/` - Old virtualenv, replaced by .venv with uv
- Removing `data/templates/` from git - Runtime output, will be regenerated
- Cleaning build artifacts - These can be regenerated

### Medium Risk
- Removing `.claude/` - Appears to be unrelated Graphite config, verify first
- Making `skill/scripts/` a build artifact - Build script already handles this correctly

### No Risk (KEPT)
- `commands/` - Active plugin system, referenced by .claude-plugin/plugin.json
- `templates/` - Source code for composable template system (recently updated)

### Mitigation
1. **Backup first**: Current state is already committed to git
2. **Test build**: Run `./build-skill.sh` after changes
3. **Verify templates**: Check that templates/ contains primary/, living/, additional/
4. **Test installation**: Install and test the generated skill
5. **Rollback available**: `git checkout HEAD -- <path>` if needed

---

## 8. Expected Outcome

### Before Cleanup
```
agent-smith/
â”œâ”€â”€ commands/              72K  âœ… KEEP (active plugin)
â”œâ”€â”€ templates/             64K  âœ… KEEP (source code)
â”œâ”€â”€ venv/                  32K  âŒ REMOVE (old venv)
â”œâ”€â”€ .claude/                ?   âŒ REMOVE (unrelated)
â”œâ”€â”€ data/templates/         ?   âŒ REMOVE (runtime output)
â”œâ”€â”€ .pytest_cache/          ?   âŒ CLEAN
â”œâ”€â”€ .mypy_cache/            ?   âŒ CLEAN
â”œâ”€â”€ .ruff_cache/            ?   âŒ CLEAN
â”œâ”€â”€ htmlcov/              140K  âŒ CLEAN
â”œâ”€â”€ agent_smith.egg-info/  56K  âŒ CLEAN
â”œâ”€â”€ skill/scripts/        1.9M  âš ï¸  BUILD ARTIFACT
â””â”€â”€ [rest kept]
```

### After Cleanup
```
agent-smith/
â”œâ”€â”€ commands/                   # Slash commands (KEPT - active)
â”œâ”€â”€ templates/                  # Composable templates (KEPT - source)
â”‚   â”œâ”€â”€ primary/
â”‚   â”œâ”€â”€ living/
â”‚   â””â”€â”€ additional/
â”œâ”€â”€ skill/                      # Skill source (scripts/ regenerated during build)
â”œâ”€â”€ scripts/                    # Main source (1.9M)
â”œâ”€â”€ data/                       # Working data (templates/ gitignored)
â”œâ”€â”€ tests/                      # Test suite
â”œâ”€â”€ docs/                       # Documentation
â”œâ”€â”€ .claude-plugin/             # Plugin metadata
â”œâ”€â”€ agent-smith.skill           # Packaged skill
â”œâ”€â”€ build-skill.sh              # Build script
â””â”€â”€ [essential files only]
```

**Result**: Cleaner repository, correct source vs. runtime separation, build artifacts properly ignored.

---

## 9. Execution Plan

**Recommended order**:

1. âœ… Review this plan
2. â¸ï¸ Get user approval
3. ğŸ”§ Update build script first (ensures scripts can be regenerated)
4. ğŸ”§ Update .gitignore
5. ğŸ§ª Test build: `./build-skill.sh`
6. ğŸ—‘ï¸ Execute Phase 1: Remove redundant directories
7. ğŸ—‘ï¸ Execute Phase 2: Clean build artifacts
8. âœ… Validate with checklist
9. ğŸ“ Commit changes
10. ğŸ§ª Final verification: rebuild and test skill

**Estimated time**: 15-20 minutes
**Reversibility**: High (git history preserved)

---

## 10. Post-Cleanup Maintenance

**Going forward**:

1. **Never commit** build artifacts (`skill/scripts/`, caches, htmlcov, etc.)
2. **Always regenerate** skill scripts via `./build-skill.sh`
3. **Keep source in sync**: Main source is `scripts/`, skill gets a copy
4. **Clean periodically**: `rm -rf .pytest_cache/ .mypy_cache/ .ruff_cache/ htmlcov/`
5. **Git pre-commit hook** (optional): Prevent committing build artifacts

---

**Status**: âœ… CORRECTED & READY FOR APPROVAL

**Next Step**: Review corrected plan and approve execution

**Important Corrections Made**:
1. `commands/` is ACTIVE (plugin system) - KEEP
2. `templates/` is SOURCE CODE (composable system) - KEEP
3. `data/templates/` is RUNTIME OUTPUT - REMOVE from git
4. Code update needed: `scripts/setup/template_selector.py` still references old path
